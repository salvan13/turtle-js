/*! turtlejs 0.1.1 2013-08-25
https://github.com/salvan13/turtle-js */
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var Turtle=function(t,e){"use strict";var n,i,r,o,s,a,c,h,u,d,f,l,p,w=1,v=[],y=0,g=function(t){n=t,i=t.block||16,f=new Image,f.src=t.spritesheet||"./assets/sprites.png",l=t.collisionHandler||function(){},r=t.height*i,o=t.width*i,s=e.querySelector(t.container),a=document.createElement("canvas"),s.appendChild(a),c=a.getContext("2d"),C(),S(),b()},b=function(){if(!p){var e=(new Date).getTime(),n=(e-y)/100;y=e,m(n),T(n)}t.requestAnimFrame(b)},m=function(t){if(d){t>.33&&(t=.33);var e,i,r=[];for(e=0;d.objects.length>e;e++)i=d.objects[e],i.active&&r.push(i);for(d.objects=r,e=0;d.objects.length>e;e++)i=d.objects[e],n.objectBehavior&&n.objectBehavior.pre&&n.objectBehavior.pre.apply(i,[t]);for(j(),e=0;d.objects.length>e;e++)i=d.objects[e],n.objectBehavior&&n.objectBehavior.post&&n.objectBehavior.post.apply(i,[t]);d.update&&d.update.apply(d,[t])}},j=function(){for(var t=0;d.objects.length>t;t++)for(var e=d.objects[t],n=0;d.objects.length>n;n++){var i=d.objects[n];if(e.id!=i.id){var r=e.w/4,o=e.h/4,s=e.w/2,a=e.h/2,c={top:{x:e.x+r,y:e.y,w:s,h:a},bottom:{x:e.x+r,y:e.y+a,w:s,h:a},left:{x:e.x,y:e.y+o,w:s,h:a},right:{x:e.x+s,y:e.y+o,w:s,h:a}};for(var h in c)if(x(c[h],i)){l(e,i,h);break}}}},x=function(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y},T=function(t){if(d){var e=A(function(e){d.draw&&d.draw.apply(d,[e,t]);for(var n=0;d.objects.length>n;n++){var i=d.objects[n];i.draw(e,t)}});c.save(),c.clearRect(0,0,a.width,a.height),d.center?c.drawImage(e,Math.min(Math.max(0,d.center.getX()),o-d.center.getW()),Math.min(Math.max(0,d.center.getY()),r-d.center.getH()),d.center.getW(),d.center.getH(),0,0,a.width,a.height):(c.scale(w,w),c.drawImage(e,0,0)),c.restore()}},A=function(t){return h||(h=document.createElement("canvas"),h.width=o,h.height=r,u=h.getContext("2d")),u.clearRect(0,0,o,r),t(u),h},C=function(){t.addEventListener("resize",function(){S()},!1)},S=function(){w=Math.min(t.innerWidth/o,t.innerHeight/r);var e=parseInt(o*w,10),n=parseInt(r*w,10);a.width=e,a.height=n,s.style.width=e+"px",s.style.height=n+"px"},k=function(t){for(var e=0;v.length>e;e++)if(v[e].id==t.id)return v[e]=t,void 0;v.push(t)},E=function(t){d=I(v,t)},I=function(t,e){for(var n=0;t.length>n;n++)if(t[n].id==e)return t[n]},R=function(){return{width:o,height:r,block:i,spritesheet:f}},F=function(t){p=t};return{init:g,addScene:k,runScene:E,getData:R,pause:F}}(window,document);Turtle.controls=function(){var t={ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,TAB:29,BACKSPACE:28,Z:90,X:88,C:67,P:80,S:83,A:65,D:68,W:87,Q:81,E:69,R:82,F:70};Turtle.keyCodes=t;var e={};window.addEventListener("keydown",function(t){e[t.keyCode]=!0},!1),window.addEventListener("keyup",function(t){e[t.keyCode]&&delete e[t.keyCode]},!1);var n=function(t){return!!e[t]};return{isKeyPressed:n}}(),Turtle.Map=function(){var t=function(t,e){for(var n=[],i=0;t.length>i;i++){n[i]=[];for(var r=0;t[i].length>r;r++){var o=e[t[i][r]];o&&(n[i][r]=o(r,i))}}return n};return{fromStrings:t}}(),Turtle.Object=function(t,e){e=e||{},this.active=!0,this.id=t,this.x=e.x||0,this.y=e.y||0,this.h=e.h||Turtle.getData().block,this.w=e.w||Turtle.getData().block,this.zIndex=e.zIndex||0,this.sx=e.sx||0,this.sy=e.sy||0,this.type=e.type||["default"],this.sprite=e.sprite||null,this.spritecnt=0,this.animspeed=e.animspeed||.7,this.objects={},this.ondraw=e.ondraw},Turtle.Object.prototype={is:function(t){for(var e=0;this.type.length>e;e++)if(t==this.type[e])return!0;return!1},draw:function(t,e){var n=Math.round(this.x),i=Math.round(this.y);if(this.sprite){var r=this.sprite.apply(this);if(r){r.nr=r.nr||1;var o=r.x+Math.round(this.spritecnt)%r.nr*this.w;return t.drawImage(Turtle.getData().spritesheet,o,r.y,this.w,this.h,n,i,this.w,this.h),this.spritecnt+=e*this.animspeed,this.spritecnt>99&&(this.spritecnt=0),void 0}}t.save(),t.fillStyle="rgba(255, 255, 255, 1)",t.fillRect(n,i,this.w,this.h),t.restore()},collect:function(t){this.objects[t]||(this.objects[t]=0),this.objects[t]++},has:function(t){return this.objects[t]||0},destroy:function(){this.active=!1}},Turtle.Scene=function(t,e){e=e||{},this.id=t,this.objects=[],this.update=e.update,this.draw=e.draw},Turtle.Scene.prototype={addObject:function(t){if(t)if("[object Array]"===Object.prototype.toString.call(t))for(var e=0;t.length>e;e++)this.addObject(t[e]);else this.objects.push(t),this.objects.sort(function(t,e){return t.zIndex-e.zIndex})}},Turtle.sound=function(){"use strict";var t={},e=function(e,n){t[e]=new Audio(n)},n=function(e,n){if(t[e]){var i=t[e];i.loop=n||!1,i.play()}};return{add:e,play:n}}();