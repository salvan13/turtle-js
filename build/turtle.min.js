/*! turtlejs 0.1.0 2013-05-26 */
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var Turtle=function(t,e){"use strict";var i,n,r,o,s,a,h,c,u,d,f,l,p=1,w=[],v=0,y=function(t){i=t,n=t.block||16,f=new Image,f.src=t.spritesheet||"./assets/sprites.png",l=t.collisionHandler||function(){},r=t.height*n,o=t.width*n,s=e.querySelector(t.container),a=document.createElement("canvas"),s.appendChild(a),h=a.getContext("2d"),A(),C(),b()},b=function(){var e=(new Date).getTime(),i=(e-v)/100;v=e,g(i),x(i),t.requestAnimFrame(b)},g=function(t){if(d){t>.33&&(t=.33);var e,n,r=[];for(e=0;d.objects.length>e;e++)n=d.objects[e],n.active&&r.push(n);for(d.objects=r,e=0;d.objects.length>e;e++)n=d.objects[e],i.objectBehavior&&i.objectBehavior.pre&&i.objectBehavior.pre.apply(n,[t]);for(j(),e=0;d.objects.length>e;e++)n=d.objects[e],i.objectBehavior&&i.objectBehavior.post&&i.objectBehavior.post.apply(n,[t]);d.update&&d.update.apply(d,[t])}},j=function(){for(var t=0;d.objects.length>t;t++)for(var e=d.objects[t],i=0;d.objects.length>i;i++){var n=d.objects[i];if(e.id!=n.id){var r=e.w/4,o=e.h/4,s=e.w/2,a=e.h/2,h={top:{x:e.x+r,y:e.y,w:s,h:a},bottom:{x:e.x+r,y:e.y+a,w:s,h:a},left:{x:e.x,y:e.y+o,w:s,h:a},right:{x:e.x+s,y:e.y+o,w:s,h:a}};for(var c in h)if(m(h[c],n)){l(e,n,c);break}}}},m=function(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.y+t.h>e.y},x=function(t){if(d){var e=T(function(e){d.draw&&d.draw.apply(d,[e,t]);for(var i=0;d.objects.length>i;i++){var n=d.objects[i];n.draw(e,t)}});h.save(),h.clearRect(0,0,a.width,a.height),h.scale(p,p),h.drawImage(e,0,0),h.restore()}},T=function(t){return c||(c=document.createElement("canvas"),c.width=o,c.height=r,u=c.getContext("2d")),u.clearRect(0,0,o,r),t(u),c},A=function(){t.addEventListener("resize",function(){C()},!1)},C=function(){p=Math.min(t.innerWidth/o,t.innerHeight/r);var e=parseInt(o*p,10),i=parseInt(r*p,10);a.width=e,a.height=i,s.style.width=e+"px",s.style.height=i+"px"},S=function(t){for(var e=0;w.length>e;e++)if(w[e].id==t.id)return w[e]=t,void 0;w.push(t)},k=function(t){d=E(w,t)},E=function(t,e){for(var i=0;t.length>i;i++)if(t[i].id==e)return t[i]},I=function(){return{width:o,height:r,block:n,spritesheet:f}};return{init:y,addScene:S,runScene:k,getData:I}}(window,document);Turtle.controls=function(){var t={ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,TAB:29,BACKSPACE:28,Z:90,X:88,C:67,P:80,S:83,A:65,D:68,W:87,Q:81,E:69,R:82,F:70};Turtle.keyCodes=t;var e={};window.addEventListener("keydown",function(t){e[t.keyCode]=!0},!1),window.addEventListener("keyup",function(t){e[t.keyCode]&&delete e[t.keyCode]},!1);var i=function(t){return!!e[t]};return{isKeyPressed:i}}(),Turtle.Map=function(){var t=function(t,e){for(var i=[],n=0;t.length>n;n++){i[n]=[];for(var r=0;t[n].length>r;r++){var o=e[t[n][r]];o&&(i[n][r]=o(r,n))}}return i};return{fromStrings:t}}(),Turtle.Object=function(t,e){e=e||{},this.active=!0,this.id=t,this.x=e.x||0,this.y=e.y||0,this.h=e.h||Turtle.getData().block,this.w=e.w||Turtle.getData().block,this.zIndex=e.zIndex||0,this.sx=e.sx||0,this.sy=e.sy||0,this.type=e.type||["default"],this.sprite=e.sprite||null,this.spritecnt=0,this.animspeed=e.animspeed||.7,this.objects={},this.ondraw=e.ondraw},Turtle.Object.prototype={is:function(t){for(var e=0;this.type.length>e;e++)if(t==this.type[e])return!0;return!1},draw:function(t,e){var i=Math.round(this.x),n=Math.round(this.y);if(this.sprite){var r=this.sprite.apply(this);if(r){r.nr=r.nr||1;var o=r.x+Math.round(this.spritecnt)%r.nr*this.w;return t.drawImage(Turtle.getData().spritesheet,o,r.y,this.w,this.h,i,n,this.w,this.h),this.spritecnt+=e*this.animspeed,this.spritecnt>99&&(this.spritecnt=0),void 0}}t.save(),t.fillStyle="rgba(255, 255, 255, 1)",t.fillRect(i,n,this.w,this.h),t.restore()},collect:function(t){this.objects[t]||(this.objects[t]=0),this.objects[t]++},has:function(t){return this.objects[t]||0},destroy:function(){this.active=!1}},Turtle.Scene=function(t,e){e=e||{},this.id=t,this.objects=[],this.update=e.update,this.draw=e.draw},Turtle.Scene.prototype={addObject:function(t){if(t)if("[object Array]"===Object.prototype.toString.call(t))for(var e=0;t.length>e;e++)this.addObject(t[e]);else this.objects.push(t),this.objects.sort(function(t,e){return t.zIndex-e.zIndex})}},Turtle.sound=function(){"use strict";var t={},e=function(e,i){t[e]=i},i=function(e,i){if(t[e]){var n=new Audio(t[e]);n.loop=i||!1,n.play()}};return{add:e,play:i}}();